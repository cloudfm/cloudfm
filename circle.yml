machine:
  pre:
    - curl -sSf https://static.rust-lang.org/rustup.sh | sudo sh -s -- --spec=nightly-2016-05-25
  environment:
    PATH: ~/.cargo/bin:$PATH
dependencies:
  override:
    - pip install ghp-import
    - npm install -g webpack typings
    - pushd app && npm install && typings install && popd
    - cargo install mdbook || true
  cache_directories:
    - "~/.cargo"
test:
  override:
    - pushd lib && cargo build && cargo test && popd
    - pushd app && webpack && popd
    - pushd doc && mdbook build && popd
general:
  branches:
    ignore:
      - gh-pages
      - staging
deployment:
  staging:
    branch: master
    commands:
      - git push origin master:staging
  docs:
    branch: master
    commands:
      - ghp-import -n doc/book -m "[ci skip] build docs"
      - git push -fq origin gh-pages
